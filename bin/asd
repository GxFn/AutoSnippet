#!/usr/bin/env sh
# AutoSnippet 入口：优先使用原生校验入口（bin/asd-verify），否则回退到 node bin/asnip.js
# 解析 $0 的符号链接，使 DIR 指向包内 bin 目录（npm install -g 时 $0 可能是 global bin 下的 symlink）
SCRIPT="$0"
while [ -L "$SCRIPT" ]; do
	TARGET="$(readlink "$SCRIPT")"
	case "$TARGET" in
		/*) SCRIPT="$TARGET" ;;
		*) SCRIPT="$(cd "$(dirname "$SCRIPT")" && pwd)/$TARGET" ;;
	esac
done
DIR="$(cd "$(dirname "$SCRIPT")" && pwd)"
# 将调用时的当前目录传给 Node，供查找项目根（dev:link 等场景下 process.cwd() 可能不是用户所在目录）
ASD_CWD="$(pwd)"
export ASD_CWD
# 优先 Swift 入口（完整性校验，仅 macOS），否则回退 node
if [ -x "$DIR/asd-verify" ]; then
	exec "$DIR/asd-verify" "$@"
else
	exec node "$DIR/asnip.js" "$@"
fi
