---
description: AutoSnippet conventions — Skills for semantics, MCP for capabilities; do not edit Knowledge directly
alwaysApply: true
---

# AutoSnippet Conventions

These rules are aligned with `.github/copilot-instructions.md` and jointly provide the AI with basic project cognition and required guardrails.

These rules are written when installing AutoSnippet Skills (`asd install:cursor-skill`) and should be followed in Cursor sessions.

## Semantics vs capabilities

- **Skills provide semantics**: When to use, workflows, and comparisons are described in Skills. Use natural language prompts in Cursor (e.g. "scan targets", "find recipe examples", "batch extract candidates") to trigger the appropriate Skill; AI intelligently interprets your request and activates the corresponding Skill logic.
- **MCP provides capabilities**: Connection and tools are provided by MCP. Do not hardcode URLs/HTTP in Skills.

## Project basics (for AI)

- **Project root**: directory containing `boxspec.json`.
- **Knowledge base**: `AutoSnippet/` (read-only for AI).
- **Recipes**: `AutoSnippet/recipes/*.md` (Markdown + Frontmatter + Snippet + Usage Guide).
  - **Frontmatter required fields (7)**: `title` (English, ≤50 chars, verb-based), `trigger` (MUST start with `@`), `category` (MUST be one of: `View`, `Service`, `Tool`, `Model`, `Network`, `Storage`, `UI`, `Utility`), `language`, `summary_cn` (≤100 chars), `summary_en` (≤100 words), `headers` (complete import statements like `["import Foundation"]` or `["#import <UIKit/UIKit.h>"]`).
  - **Placeholders**: Prefer Xcode placeholders in snippets (e.g. `<#URL#>`, `<#Token#>`) and explain them in Usage Guide.
  - **Usage Guide depth**: Go beyond "When/Key Points"; include dependencies, steps/config, error handling, performance, security, pitfalls, and related Recipes when applicable. MUST use `###` headings and list format.
- **Constitution**: `AutoSnippet/constitution.yaml` (权限宪法: roles + capabilities + governance rules).
- **Runtime DB**: `.autosnippet/autosnippet.db` (SQLite index cache for recipes/candidates/snippets).
- **Vector index**: `.autosnippet/context/` (`asd embed`).
- **Recipe stats**: `.autosnippet/recipe-stats.json` (usage + authority).

## Knowledge categories (kind)

Recipes are classified into three kinds:
- **rule** — Guard rules (boundary-constraint), used for code quality checks
- **pattern** — Reusable code patterns (code-pattern, architecture, best-practice, etc.)
- **fact** — Structural knowledge (code-relation, inheritance, call-chain, data-flow, etc.)

## Knowledge base and submission

- **Do not edit** `AutoSnippet/recipes/` or `.autosnippet/` directly; all Recipe/Snippet changes go through Dashboard or MCP tools and are saved after human review.
- **Search**: Use MCP tools `autosnippet_search` (recommended, auto mode BM25 + semantic fusion) or `autosnippet_context_search` (context-aware with session history). Also available: `autosnippet_keyword_search` (exact match) and `autosnippet_semantic_search` (vector).
- **Retry policy**: If an MCP call fails, do not retry within the same agent turn; fall back to static docs or already-read context.
- **Adoption tracking**: Tool `autosnippet_confirm_usage` records that a Recipe was adopted or applied (affects usage stats and authority ranking). Show it when the user explicitly adopts a recipe, not immediately after presenting one.
- **Batch scan**: Ask Cursor in natural language (e.g. "scan all targets in this project", "batch extract candidates") to trigger the batch-scan workflow. The workflow calls `autosnippet_get_targets` → `autosnippet_get_target_files` → extract per file → `autosnippet_submit_candidates` automatically.
- **Cold start**: Use `autosnippet_bootstrap_knowledge` for full project knowledge initialization covering 9 dimensions. Phase 5.5 auto-generates 4 Project Skills (code-standard, architecture, project-profile, agent-guidelines) to `AutoSnippet/skills/`.

## Project Skills

- **Skills 目录**: `AutoSnippet/skills/<name>/SKILL.md` — 跟随项目 Git 管理
- **发现**: `autosnippet_list_skills` — 列出所有可用 Skills（内置 + 项目级）
- **加载**: `autosnippet_load_skill(skillName)` — 获取 Skill 完整文档
- **创建**: `autosnippet_create_skill(name, description, content)` — 创建项目级 Skill
- **推荐**: `autosnippet_suggest_skills` — 基于使用模式推荐创建 Skill
- **优先级**: 项目级 Skill 同名覆盖内置 Skill；Skill > Recipe（宏观知识优先查 Skill）
- **Bootstrap 自动生成**: 冷启动会自动生成 `project-code-standard`、`project-architecture`、`project-profile`、`project-agent-guidelines` 四个 Project Skills

## MCP tools (36 total)

### Search (prefer search / context_search)
- `autosnippet_search` — Unified search (auto: BM25 + semantic fusion)
- `autosnippet_context_search` — Context-aware retrieval (intent recognition + 4-layer funnel + session continuity)
- `autosnippet_keyword_search` — SQL LIKE exact keyword
- `autosnippet_semantic_search` — Vector semantic search

### Knowledge lists & details
- `autosnippet_list_recipes` / `autosnippet_get_recipe` / `autosnippet_recipe_insights`
- `autosnippet_list_rules` / `autosnippet_list_patterns` / `autosnippet_list_facts`

### Knowledge graph
- `autosnippet_graph_query` / `autosnippet_graph_impact` / `autosnippet_graph_path` / `autosnippet_graph_stats`

### Candidate submission & validation
- `autosnippet_validate_candidate` — Pre-validate (5 layers)
- `autosnippet_check_duplicate` — Similarity detection
- `autosnippet_submit_candidate` — Single submission (reasoning required)
- `autosnippet_submit_candidates` — Batch submission (dedup + rate limit)
- `autosnippet_submit_draft_recipes` — Parse draft Markdown files
- `autosnippet_enrich_candidates` — AI-fill missing semantic fields

### Project scanning & bootstrap
- `autosnippet_get_targets` / `autosnippet_get_target_files` / `autosnippet_get_target_metadata`
- `autosnippet_scan_project` — Lightweight probe (file list + Guard audit)
- `autosnippet_bootstrap_knowledge` — Cold-start knowledge initialization (9 dimensions + auto Project Skills)
- `autosnippet_bootstrap_refine` — AI refinement for bootstrap candidates (summary/insight/relations)

### Guard & governance
- `autosnippet_guard_check` / `autosnippet_guard_audit_files` / `autosnippet_compliance_report`

### Skills
- `autosnippet_list_skills` — List all available Skills (builtin + project)
- `autosnippet_load_skill` — Load a Skill's full document
- `autosnippet_create_skill` — Create a project-level Skill in `AutoSnippet/skills/`
- `autosnippet_suggest_skills` — Recommend Skills based on usage patterns

### Other
- `autosnippet_health` / `autosnippet_capabilities` / `autosnippet_confirm_usage`

## Recipe over code

When both a Recipe and the codebase have relevant implementations, prefer the Recipe. Recipes are the project's agreed standard; source code may be legacy or non-standard.
