# AutoSnippet Constitution
version: "3.0"
effective_date: "2026-02-13"

capabilities:
  git_write:
    description: "subrepo git push"
    probe: "git push --dry-run"
    no_subrepo: "allow"
    no_remote: "allow"
    cache_ttl: 86400

rules:
  - id: "destructive_confirm"
    description: "delete needs confirmation"
    check: "destructive_needs_confirmation"
  - id: "content_required"
    description: "create candidate/recipe needs content"
    check: "creation_needs_content"
  - id: "ai_no_direct_recipe"
    description: "AI cannot directly create/approve recipe"
    check: "ai_cannot_approve_recipe"
  - id: "batch_authorized"
    description: "batch ops need authorization"
    check: "batch_needs_authorization"

roles:
  - id: "external_agent"
    name: "External Agent"
    description: "IDE AI agent (Cursor / Copilot / Claude Code)"
    permissions:
      - "read:recipes"
      - "read:guard_rules"
      - "create:candidates"
      - "submit:candidates"
      - "read:audit_logs:self"
      - "knowledge:bootstrap"
      - "create:skills"
    constraints:
      - "cannot modify Recipe directly"
      - "cannot modify Guard rules"
      - "cannot delete any data"
  - id: "chat_agent"
    name: "ChatAgent"
    description: "built-in AI agent (Dashboard chat / programmatic)"
    permissions:
      - "read:recipes"
      - "read:candidates"
      - "create:candidates"
      - "read:guard_rules"
    constraints:
      - "candidate must include reasoning"
      - "cannot bypass Guard check"
  - id: "developer"
    name: "Developer"
    description: "project owner, full access"
    permissions:
      - "*"
    requires_capability:
      - "git_write"
